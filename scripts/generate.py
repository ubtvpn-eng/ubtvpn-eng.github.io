import os
import time
import google.generativeai as genai
from slugify import slugify
from topics import topics

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
# –ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á —Ç—É—Ç: https://aistudio.google.com/app/apikey
API_KEY = "AIzaSyDgYOAYZzz97fdbOiG7Ew00eoDjInrqcak" 

# –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–µ–π
OUTPUT_DIR = "../src/content/blog"

# –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–†–æ–ª—å)
SYSTEM_PROMPT = """
–¢—ã ‚Äî Senior Technical Writer –∏ —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Network Security & Privacy). 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–∏—Å–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ, –≥–ª—É–±–æ–∫–∏–µ —Å—Ç–∞—Ç—å–∏ –¥–ª—è –±–ª–æ–≥–∞ –Ω–∞ –¥–≤–∏–∂–∫–µ Astro.

–¢–í–û–Ø –†–û–õ–¨:
–¢—ã –ø–∏—à–µ—à—å –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Ü–µ–Ω–∏—Ç —Ç–æ—á–Ω–æ—Å—Ç—å, –Ω–µ–Ω–∞–≤–∏–¥–∏—Ç "–≤–æ–¥—É" –∏ —Ö–æ—á–µ—Ç —Ä–µ—à–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É. 
–¢—ã –æ–±—Ä–∞—â–∞–µ—à—å—Å—è –∫ —á–∏—Ç–∞—Ç–µ–ª—é –Ω–∞ "–í—ã", –Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ.

–°–¢–†–û–ì–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –§–û–†–ú–ê–¢–£ (MARKDOWN):
1. –í–µ—Å—å –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Ñ–∞–π–ª–∞ .md. –ù–µ –ø–∏—à–∏ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π –≤—Ä–æ–¥–µ "–í–æ—Ç –≤–∞—à–∞ —Å—Ç–∞—Ç—å—è".
2. –í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–ª–æ–∫ Frontmatter (–º–µ–∂–¥—É —Ç—Ä–æ–π–Ω—ã–º–∏ –¥–µ—Ñ–∏—Å–∞–º–∏ ---).

–®–ê–ë–õ–û–ù FRONTMATTER:
---
title: '–ó–¥–µ—Å—å —Ü–µ–ø–ª—è—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–¥–æ 60 —Å–∏–º–≤–æ–ª–æ–≤)'
description: 'SEO-–æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Å–Ω–∏–ø–ø–µ—Ç–∞ Google (–¥–æ 160 —Å–∏–º–≤–æ–ª–æ–≤). –î–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Ç–µ–º—ã.'
pubDate: 2026-01-15
author: 'NetFreedom Admin'
image: '/images/default-cover.jpg'
tags: ['–¢–µ–≥1', '–¢–µ–≥2', '–¢–µ–≥3']
---

–õ–û–ì–ò–ö–ê –ù–ê–ü–ò–°–ê–ù–ò–Ø:
- –ò—Å–ø–æ–ª—å–∑—É–π H2 (##) –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ H3 (###) –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤.
- –í—ã–¥–µ–ª—è–π –≤–∞–∂–Ω—ã–µ –º—ã—Å–ª–∏ **–∂–∏—Ä–Ω—ã–º**.
- –î–ª–∏–Ω–∞ —Å—Ç–∞—Ç—å–∏: –æ—Ç 4000 –¥–æ 7000 –∑–Ω–∞–∫–æ–≤.
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞, –µ—Å–ª–∏ —Ç–µ–º–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è.
- –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π.
"""

def generate_article(topic):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—å—é –ø–æ —Ç–µ–º–µ —á–µ—Ä–µ–∑ Gemini Pro"""
    model = genai.GenerativeModel('gemini-1.5-flash')
    
    prompt = f"{SYSTEM_PROMPT}\n\n–¢–ï–ú–ê –°–¢–ê–¢–¨–ò: {topic}"
    
    try:
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ '{topic}': {e}")
        return None

def save_article(content, topic):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ç—å—é –≤ .md —Ñ–∞–π–ª"""
    if not content:
        return

    # –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π slug –∏–∑ —Ç–µ–º—ã (—Ç—Ä–∞–Ω—Å–ª–∏—Ç)
    # –ù–∞–ø—Ä–∏–º–µ—Ä: "–ß—Ç–æ —Ç–∞–∫–æ–µ VPN" -> "chto-takoe-vpn.md"
    filename = slugify(topic) + ".md"
    filepath = os.path.join(OUTPUT_DIR, filename)

    with open(filepath, "w", encoding="utf-8") as f:
        f.write(content)
    
    print(f"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {filename}")

def main():
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
    if API_KEY == "–í–°–¢–ê–í–¨_–°–Æ–î–ê_–°–í–û–ô_API_KEY":
        print("‚ùå –û–®–ò–ë–ö–ê: –í—ã –Ω–µ –≤—Å—Ç–∞–≤–∏–ª–∏ API Key –≤ —Å–∫—Ä–∏–ø—Ç!")
        print("–û—Ç–∫—Ä–æ–π—Ç–µ scripts/generate.py –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é API_KEY")
        return

    genai.configure(api_key=API_KEY)
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –Ω–µ—Ç
    os.makedirs(OUTPUT_DIR, exist_ok=True)

    print(f"üöÄ –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é {len(topics)} —Å—Ç–∞—Ç–µ–π...")

    for i, topic in enumerate(topics):
        print(f"[{i+1}/{len(topics)}] –ì–µ–Ω–µ—Ä–∏—Ä—É—é: {topic}...")
        
        content = generate_article(topic)
        
        if content:
            save_article(content, topic)
        
        # –ü–∞—É–∑–∞ —á—Ç–æ–±—ã –Ω–µ —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç—ã (Gemini Free tier –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã)
        time.sleep(4) 

if __name__ == "__main__":
    main()
