import os
import time
import google.generativeai as genai
from slugify import slugify # pip install python-slugify

# --- –ù–ê–°–¢–†–û–ô–ö–ò ---
# –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–® –ö–õ–Æ–ß
GOOGLE_API_KEY = "AIzaSyDgYOAYZzz97fdbOiG7Ew00eoDjInrqcak" 

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–µ–ª—å 1.5 Flash (–æ–Ω–∞ –±—ã—Å—Ç—Ä–∞—è, –¥–µ—à–µ–≤–∞—è/–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è)
MODEL_NAME = "gemini-3-flash"

# –ü–∞–ø–∫–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
BASE_OUTPUT_DIR = "../src/content/blog"

# --- –¢–ï–ú–´ (–í–∫–ª—é—á–∞—è —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–Ω—ã–µ) ---
TOPICS = [
    # –ë–ª–æ–∫ –†–µ–π—Ç–∏–Ω–≥–æ–≤ (–ø–æ–ø–∞–¥–µ—Ç –≤ /reviews)
    "–†–µ–π—Ç–∏–Ω–≥ VPN –†–æ—Å—Å–∏–∏ 2026: –ö—Ç–æ –≤—ã–∂–∏–ª –ø–æ—Å–ª–µ –ß–µ–±—É—Ä–Ω–µ—Ç–∞",
    "–¢–æ–ø-5 —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫: –û–±–∑–æ—Ä 2026",
    
    # –ë–ª–æ–∫ –ì–∞–π–¥–æ–≤ (–ø–æ–ø–∞–¥–µ—Ç –≤ /guides)
    "–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å VLESS –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ Keenetic: –ì–∞–π–¥",
    "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ AmneziaWG –¥–ª—è —á–∞–π–Ω–∏–∫–æ–≤: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
    
    # –û–±—â–µ–µ (–ø–æ–ø–∞–¥–µ—Ç –≤ /general)
    "–ü–æ—á–µ–º—É –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å—Ç–∞–ª —Ç–∞–∫–∏–º –º–µ–¥–ª–µ–Ω–Ω—ã–º: –ê–Ω–∞–ª–∏–∑",
]

# --- –ù–ê–°–¢–†–û–ô–ö–ê API ---
genai.configure(api_key=GOOGLE_API_KEY)
model = genai.GenerativeModel(MODEL_NAME)

# --- –£–ú–ù–´–ï –ü–†–û–ú–ü–¢–´ ---
def get_system_prompt(topic):
    # –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞—Ç—å—è –ø—Ä–æ –±—É–¥—É—â–µ–µ (2026 –≥–æ–¥)
    if "2026" in topic:
        return """
        –¢—ã ‚Äî IT-–∂—É—Ä–Ω–∞–ª–∏—Å—Ç –∏–∑ –±—É–¥—É—â–µ–≥–æ (—Å–µ—Ä–µ–¥–∏–Ω–∞ 2026 –≥–æ–¥–∞). 
        –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–ø–∏—Å–∞—Ç—å –æ–±–∑–æ—Ä VPN —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —É—Å–ª–æ–≤–∏—è—Ö —Ç–æ—Ç–∞–ª—å–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–∏ —Ä—É–Ω–µ—Ç–∞.
        
        –õ–µ–≥–µ–Ω–¥–∞ –º–∏—Ä–∞ 2026:
        - –û–±—ã—á–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (WireGuard, OpenVPN) –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é.
        - –†–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ HTTPS (Reality, VLESS) –∏ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.
        - –ü–æ—è–≤–∏–ª–∏—Å—å "–ì–æ—ÅVPN" (–±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏) –∏ –ø–æ–¥–ø–æ–ª—å–Ω—ã–µ Mesh-—Å–µ—Ç–∏.
        - Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏.
        
        –ü—Ä–∏–¥—É–º–∞–π –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã–µ, –Ω–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "FreedomRoute", "BearPass", "KryptonMesh").
        –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Frontmatter –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±—É–¥—É—â–µ–π: 2026-02-20.
        """
    
    # –û–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    return """
    –¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç—å—é –¥–ª—è –±–ª–æ–≥–∞ Astro.
    –ò—Å–ø–æ–ª—å–∑—É–π Markdown.
    """

def generate_content(topic):
    folder = "general"
    if any(x in topic.lower() for x in ["—Ä–µ–π—Ç–∏–Ω–≥", "—Ç–æ–ø", "–æ–±–∑–æ—Ä"]):
        folder = "reviews"
    elif any(x in topic.lower() for x in ["–∫–∞–∫", "–≥–∞–π–¥", "–Ω–∞—Å—Ç—Ä–æ–π–∫–∞", "–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"]):
        folder = "guides"
        
    print(f"üöÄ –ì–µ–Ω–µ—Ä–∏—Ä—É—é: {topic} -> –ø–∞–ø–∫–∞ /{folder}...")

    # –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
    prompt = f"""
    {get_system_prompt(topic)}

    –¢–í–û–Ø –ó–ê–î–ê–ß–ê: –ù–∞–ø–∏—à–∏ —Å—Ç–∞—Ç—å—é –Ω–∞ —Ç–µ–º—É "{topic}".
    
    –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
    1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω–∞—á–Ω–∏ —Å Frontmatter:
    ---
    title: '{topic}'
    description: 'SEO –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ 150 –∑–Ω–∞–∫–æ–≤'
    pubDate: 2024-06-01 (–ò–ª–∏ 2026-02-20 –µ—Å–ª–∏ —Ç–µ–º–∞ –ø—Ä–æ –±—É–¥—É—â–µ–µ)
    image: '/images/{slugify(topic)}.jpg'
    tags: ['Tag1', 'Tag2']
    ---
    
    2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –í–≤–µ–¥–µ–Ω–∏–µ, H2 –ó–∞–≥–æ–ª–æ–≤–∫–∏, H3 –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏, –í—ã–≤–æ–¥.
    3. –ï—Å–ª–∏ —ç—Ç–æ –≥–∞–π–¥ ‚Äî –ø–∏—à–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –±–ª–æ–∫–∞—Ö –∫–æ–¥–∞.
    4. –û–±—ä–µ–º: –æ—Ç 3000 –∑–Ω–∞–∫–æ–≤.
    """

    try:
        # –ó–∞–ø—Ä–æ—Å –∫ Gemini
        response = model.generate_content(prompt)
        return response.text, folder
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ API: {e}")
        return None, None

def save_file(topic, content, folder):
    # –°–æ–∑–¥–∞–µ–º –ø—É—Ç—å: src/content/blog/reviews/
    target_dir = os.path.join(BASE_OUTPUT_DIR, folder)
    if not os.path.exists(target_dir):
        os.makedirs(target_dir)
        print(f"üìÅ –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞: {target_dir}")

    filename = slugify(topic) + ".md"
    filepath = os.path.join(target_dir, filename)

    with open(filepath, "w", encoding="utf-8") as f:
        f.write(content)
    print(f"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {filepath}")

# --- –ó–ê–ü–£–°–ö ---
if __name__ == "__main__":
    print("ü§ñ –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (Gemini 1.5)...")
    
    for topic in TOPICS:
        content, folder = generate_content(topic)
        if content:
            save_file(topic, content, folder)
            time.sleep(2) # –ü–∞—É–∑–∞ —á—Ç–æ–±—ã –Ω–µ —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç—ã (—É Gemini 15 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
            
    print("üéâ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å –ø–∞–ø–∫—É src/content/blog")
