---
title: 'Настройка AdGuard Home вместе с VPN (блокировка рекламы)'
description: 'Узнайте, как объединить AdGuard Home и VPN для максимальной приватности, блокировки рекламы на всех устройствах и защиты DNS-трафика.'
pubDate: 2026-02-20
author: 'NetFreedom Admin'
image: '/images/nastroika-adguard-home-vmeste-s-vpn-blokirovka-reklamy.jpg'
tags: ['VPN', 'Security']
---

В эпоху тотального надзора и агрессивного маркетинга стандартных средств защиты становится недостаточно. Обычный VPN скрывает ваш IP-адрес и шифрует трафик, но он не всегда эффективно справляется с фильтрацией телеметрии, трекеров и назойливой рекламы, которая встроена в приложения и сайты. С другой стороны, AdGuard Home (AGH) — это мощный инструмент сетевого уровня, который позволяет фильтровать DNS-запросы.

Сочетание AdGuard Home и VPN создает «двойной заслон»: VPN обеспечивает анонимность и обход блокировок, а AdGuard Home очищает ваш трафик от мусора еще до того, как он попадет на ваше устройство. В этой статье мы подробно разберем, как настроить эту связку для достижения максимальной безопасности.

## Зачем совмещать AdGuard Home и VPN?

Многие задаются вопросом: «Разве в моем VPN нет функции блокировки рекламы?». Большинство коммерческих VPN-провайдеров предлагают функции вроде "CleanWeb" или "NetShield". Однако у них есть существенные недостатки:
1. **Отсутствие гибкости:** Вы не можете сами решать, какие домены блокировать, а какие — нет.
2. **Проприетарность:** Вы не видите логи запросов и не знаете, что именно блокируется.
3. **Ограниченность:** Эти функции часто работают только в официальных приложениях провайдера.

AdGuard Home, установленный вместе с вашим личным VPN-сервером (например, на базе WireGuard или OpenVPN), дает вам полный контроль над домашней или корпоративной сетью.

### Основные преимущества связки:
*   **Экономия трафика и заряда батареи:** Рекламные скрипты не загружаются, что особенно критично для мобильных устройств.
*   **Блокировка на уровне DNS:** Реклама вырезается не только в браузере, но и в мобильных играх, приложениях и даже на Smart TV.
*   **Защита от фишинга:** AGH автоматически блокирует доступ к известным вредоносным ресурсам.
*   **Приватность DNS:** Использование зашифрованных протоколов (DoH, DoT) исключает возможность перехвата ваших запросов провайдером (ISP).

---

## Сценарии развертывания

Существует два основных способа подружить AdGuard Home и VPN:

1.  **Облачный вариант (VPS):** Вы устанавливаете AGH и VPN-сервер на один и тот же удаленный сервер. Это идеальный вариант для защиты смартфонов и ноутбуков в публичных сетях.
2.  **Локальный вариант (Домашний роутер/Raspberry Pi):** AGH работает внутри вашей домашней сети, а VPN настроен на роутере для выхода в сеть.

В данном руководстве мы сосредоточимся на наиболее универсальном и востребованном варианте — **установке на VPS под управлением Ubuntu/Debian**.

---

## Шаг 1: Установка AdGuard Home

Самый простой и надежный способ — использование Docker. Это изолирует приложение и упрощает процесс обновления.

1.  **Обновите систему:**
    bash
    sudo apt update && sudo apt upgrade -y
    

2.  **Установите Docker и Docker Compose:**
    bash
    sudo apt install docker.io docker-compose -y
    

3.  **Создайте конфигурационный файл `docker-compose.yml`:**
    yaml
    version: '3'
    services:
      adguardhome:
        image: adguard/adguardhome
        container_name: adguardhome
        restart: unless-stopped
        volumes:
          - ./workdir:/opt/adguardhome/work
          - ./confdir:/opt/adguardhome/conf
        ports:
          - "53:53/tcp"
          - "53:53/udp"
          - "80:80/tcp"
          - "443:443/tcp"
          - "3000:3000/tcp"
    

4.  **Запустите контейнер:**
    bash
    sudo docker-compose up -d
    

Теперь панель управления доступна по адресу `http://IP_вашего_сервера:3000`. Пройдите первичную настройку, задав логин и пароль администратора.

---

## Шаг 2: Настройка VPN (WireGuard)

Чтобы AdGuard Home фильтровал трафик вашего VPN, необходимо указать IP-адрес AGH в качестве DNS-сервера в конфигурации VPN.

Предположим, вы используете популярный скрипт автоматической установки WireGuard (например, от `angristan` или `Nyr`). При создании клиента скрипт спросит: "Which DNS do you want to use?".

**Внимание!** Вместо стандартных Google (8.8.8.8) или Cloudflare (1.1.1.1), вам нужно указать внутренний IP-адрес вашего сервера в VPN-сети. Обычно это `10.8.0.1` (для OpenVPN) или `10.7.0.1` (для WireGuard).

### Ручная правка конфига WireGuard (`wg0.conf`):

Откройте файл конфигурации сервера:
bash
sudo nano /etc/wireguard/wg0.conf


Убедитесь, что в секции `[Interface]` разрешен проброс трафика, а клиенты направляются на IP сервера. Но самое важное — это настройки на стороне клиента.

### Конфиг клиента (`client.conf`):
ini
[Interface]
PrivateKey = <CLIENT_PRIVATE_KEY>
Address = 10.7.0.2/32
DNS = 10.7.0.1  # Указываем IP сервера, где запущен AdGuard Home
...


Теперь, когда клиент подключается к VPN, все его DNS-запросы будут уходить в туннель и обрабатываться AdGuard Home.

---

## Шаг 3: Настройка AdGuard Home для работы через VPN

Чтобы AGH корректно принимал запросы из VPN-туннеля, нужно проверить настройки доступа в веб-интерфейсе:

1.  Перейдите в **Настройки** -> **Настройки DNS**.
2.  В поле **Upstream DNS-серверы** введите надежные зашифрованные серверы (например, `https://dns.cloudflare.com/dns-query`). Это защитит запросы самого AGH.
3.  Прокрутите вниз до раздела **Ограничения доступа**.
4.  Убедитесь, что в поле **Разрешенные клиенты** не указано ничего лишнего, либо добавьте туда подсеть вашего VPN (например, `10.7.0.0/24`), чтобы никто извне не мог использовать ваш резолвер.

---

## Шаг 4: Проверка на утечки DNS (DNS Leak Test)

После настройки связки критически важно убедиться, что ваши запросы действительно идут через AdGuard Home, а не "утекают" к вашему интернет-провайдеру.

1.  Подключитесь к вашему VPN.
2.  Зайдите на сайт [dnsleaktest.com](https://dnsleaktest.com).
3.  Запустите "Extended test".
4.  **Результат:** Вы должны увидеть только IP-адрес вашего VPS. Если в списке появились серверы вашего домашнего провайдера — значит, настройка DNS в VPN выполнена неверно.

---

## Тонкая настройка фильтрации

Для того чтобы блокировка была максимально эффективной, рекомендую добавить следующие списки фильтров в разделе **Фильтры** -> **Списки DNS-фильтров**:

*   **AdAway:** Отлично справляется с мобильной рекламой.
*   **OISD (Big/Small):** Один из самых полных и при этом стабильных списков, который не «ломает» сайты.
*   **EasyList:** Стандарт индустрии.
*   **RuAdList:** Необходим для корректной блокировки рекламы в рунете.

**Совет от эксперта:** Не включайте слишком много списков одновременно (более 5-7). Это может привести к ложным срабатываниям и замедлению обработки запросов, хотя AGH очень быстр благодаря алгоритмам индексации.

---

## Возможные проблемы и их решение

### Конфликт 53 порта
Если при запуске AdGuard Home вы получаете ошибку `bind: address already in use`, это означает, что в системе уже запущен стандартный резолвер `systemd-resolved`.

**Решение:**
1. Отключите его:
   bash
   sudo systemctl stop systemd-resolved
   sudo systemctl disable systemd-resolved
   
2. Отредактируйте `/etc/resolv.conf`, указав там сторонний DNS (например, 1.1.1.1), чтобы сервер не потерял интернет.

### VPN подключается, но интернета нет
Скорее всего, проблема в правилах `iptables` (Firewall). Нужно разрешить прохождение трафика между интерфейсом VPN и сетевым интерфейсом сервера.

Для WireGuard добавьте правила в секцию `[Interface]` файла `wg0.conf`:
bash
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

*(Замените `eth0` на имя вашего основного сетевого интерфейса).*

---

## Заключение

Связка AdGuard Home и VPN — это, пожалуй, лучший способ обеспечить себе комфортный и безопасный серфинг в 2026 году. Вы не только избавляетесь от навязчивой рекламы и трекеров, но и получаете полный контроль над своим сетевым трафиком.

Настройка может показаться сложной на первый взгляд, но единожды сконфигурированная система работает месяцами, не требуя вмешательства. Помните, что кибербезопасность — это не конечный результат, а процесс. Регулярно обновляйте списки фильтров и Docker-контейнеры, чтобы оставаться под надежной защитой.

**Будьте свободны от рекламы и слежки!**